function renderizarDetalhes(e){const t=document.getElementById("detalhe-img-main"),a=document.getElementById("detalheThumbnails"),n=document.getElementById("detalheNome"),o=document.getElementById("detalhePrecoContainer"),r=document.getElementById("detalheDescricao"),c=document.getElementById("detalheAddCart");if(!e)return void(n.textContent="Produto não encontrado.");const d=e.images&&e.images.length?e.images:["https://via.placeholder.com/800x800?text=Sem+Imagem"],i=d[0],l=formatPrice(e.preco||0),s=e.precoOriginal&&e.precoOriginal!==e.preco?`<span class="preco-original">${formatPrice(e.precoOriginal)}</span>`:"",m=`${s}<span class="preco-atual">${l}</span>`,g=e.descricao?escapeHtml(e.descricao).replace(/\n/g,"<br>"):"Nenhuma descrição disponível.",h=getCart(),p=h.find(t=>t.id.toString()===e.id.toString()&&!t.observacao),u=p?"✅ Já no carrinho":"Adicionar ao Carrinho";t.src=escapeHtml(i),t.alt=escapeHtml(e.nome),n.textContent=escapeHtml(e.nome),o.innerHTML=m,r.innerHTML=g,c&&(c.textContent=u,p&&(c.disabled=!0)),vazioElemento(a),d.forEach((e,t)=>{const n=document.createElement("img");n.src=escapeHtml(e),n.alt=`Miniatura ${t+1}`,n.dataset.src=escapeHtml(e),0===t&&n.classList.add("active"),a.appendChild(n)}),adicionarClickHandlerMiniaturasDetalhe(a,t)}function adicionarClickHandlerMiniaturasDetalhe(e,t){e.addEventListener("click",a=>{"IMG"===a.target.tagName&&(e.querySelectorAll("img").forEach(e=>e.classList.remove("active")),a.target.classList.add("active"),t.src=a.target.dataset.src)})}document.addEventListener("DOMContentLoaded",()=>{let e;initCheckout();try{const t=new URLSearchParams(window.location.search),a=t.get("data");if(!a)throw new Error("Nenhum dado de produto encontrado na URL.");try{e=JSON.parse(a)}catch(t){try{e=JSON.parse(decodeURIComponent(a))}catch(t){console.warn("Tentando corrigir URI malformada...");const n=a.replace(/%(?![0-9][0-9a-fA-F]+)/g,"%25");e=JSON.parse(decodeURIComponent(n))}}e.id=e.id.toString(),renderizarDetalhes(e),document.title=`${e.nome||"Detalhes"} - Eleven Store`;const n=document.getElementById("detalheAddCart");n&&n.addEventListener("click",()=>{let t=getCart();const a=document.getElementById("detalheObs"),n=a?a.value.trim():"",o=t.findIndex(t=>t.id===e.id&&(t.observacao||"")===n);o>-1?t[o].quantity++:t.push({id:e.id,nome:e.nome,preco:e.preco,quantity:1,observacao:n}),saveCart(t),updateCartButtonText(),abrirModalCarrinho()})}catch(e){console.error("Erro fatal ao carregar detalhes:",e);const t=document.getElementById("detalheNome");t&&(t.textContent="Erro ao carregar produto. Volte e tente novamente.")}});